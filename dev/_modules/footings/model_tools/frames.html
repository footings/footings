
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>footings.model_tools.frames &#8212; Footings 0.10.0rc0 documentation</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../../../index.html">
    
      <p class="title">Footings</p>
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../installation.html">Installation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../principles.html">Principles</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../tutorials/index.html">Tutorials</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../api.html">API</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../license.html">License</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../../changelog.html">Changelog</a>
        </li>
        
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/footings/footings" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for footings.model_tools.frames</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">footings.utils</span> <span class="kn">import</span> <span class="n">dispatch_function</span>


<span class="k">def</span> <span class="nf">_month_diff</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="n">months</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="n">end</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="n">start</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span><span class="o">.</span><span class="n">day</span> <span class="o">&gt;</span> <span class="n">start</span><span class="o">.</span><span class="n">day</span><span class="p">:</span>
        <span class="n">months</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">months</span>


<span class="k">def</span> <span class="nf">_day_diff</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>


<span class="nd">@dispatch_function</span><span class="p">(</span><span class="n">key_parameters</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,))</span>
<span class="k">def</span> <span class="nf">freq_dispatcher</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No registered function based on passed paramters and no default function.&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="nd">@freq_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">_month_diff</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">end_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>


<span class="nd">@freq_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">_month_diff</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">period</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">end_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">period</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>


<span class="nd">@freq_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">_month_diff</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">end_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>


<span class="nd">@freq_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">_day_diff</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">end_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>


<span class="nd">@freq_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_duration</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">_day_diff</span><span class="p">(</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">end_dt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
        <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">frame</span><span class="p">[</span><span class="n">end_duration</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_dt</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">period</span><span class="p">)</span> <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>


<span class="nd">@dispatch_function</span><span class="p">(</span><span class="n">key_parameters</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;kw&quot;</span><span class="p">,))</span>
<span class="k">def</span> <span class="nf">kwarg_dispatcher</span><span class="p">(</span>
    <span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">kw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No registered function based on passed paramters and no default function.&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_year&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span> <span class="o">=</span> <span class="n">kwarg_dispatcher</span><span class="p">(</span>
        <span class="n">tbl</span><span class="o">=</span><span class="n">tbl</span><span class="p">,</span>
        <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span>
        <span class="n">col_nm</span><span class="o">=</span><span class="n">col_nm</span><span class="p">,</span>
        <span class="n">start_dt</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
        <span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_month&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_quarter&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span> <span class="o">=</span> <span class="n">kwarg_dispatcher</span><span class="p">(</span>
        <span class="n">tbl</span><span class="o">=</span><span class="n">tbl</span><span class="p">,</span>
        <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span>
        <span class="n">col_nm</span><span class="o">=</span><span class="n">col_nm</span><span class="p">,</span>
        <span class="n">start_dt</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
        <span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_month&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_month&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="n">start_dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span> <span class="o">-</span> <span class="n">start_dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_week&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">_day_diff</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">],</span> <span class="n">start_dt</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
        <span class="s2">&quot;Int64&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;duration_day&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">_day_diff</span><span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">],</span> <span class="n">start_dt</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_year&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_year_lag&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_year_lead&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_quarter&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_quarter_lag&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_quarter_lead&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_month&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_month_lag&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<span class="nd">@kwarg_dispatcher</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">kw</span><span class="o">=</span><span class="s2">&quot;calendar_month_lead&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_</span><span class="p">(</span><span class="n">tbl</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">col_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">tbl</span><span class="p">[</span><span class="n">col_nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tbl</span><span class="p">[</span><span class="n">col_date_nm</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;Int64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span>


<div class="viewcode-block" id="create_frame"><a class="viewcode-back" href="../../../generated/footings.model_tools.create_frame.html#footings.model_tools.create_frame">[docs]</a><span class="k">def</span> <span class="nf">create_frame</span><span class="p">(</span>
    <span class="n">start_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">end_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a frame with a date colum ranging from the start_dt to the end_dt.</span>

<span class="sd">    Additional columns can be created by passing kwargs (see list below) where the value is the</span>
<span class="sd">    assigned name. As an example, to add a column for duration month to be called DURATION_MONTH,</span>
<span class="sd">    passing the kwarg &quot;duration_month&quot;: &quot;DURATION_MONTH&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    start_dt : pd.Timestamp</span>
<span class="sd">        The frame start date (first date row)</span>
<span class="sd">    end_dt : pd.Timestamp</span>
<span class="sd">        The frame end date (last date row).</span>
<span class="sd">    frequency : str</span>
<span class="sd">        The frequency at which records are created.</span>
<span class="sd">    col_date_nm : str</span>
<span class="sd">        The column name to assign the date column.</span>
<span class="sd">    kwargs :</span>
<span class="sd">        end_duration \n</span>
<span class="sd">        duration_year \n</span>
<span class="sd">        duration_quarter \n</span>
<span class="sd">        duration_month \n</span>
<span class="sd">        duration_week \n</span>
<span class="sd">        duration_day \n</span>
<span class="sd">        calendar_year \n</span>
<span class="sd">        calendar_year_lag \n</span>
<span class="sd">        calendar_year_lead \n</span>
<span class="sd">        calendar_quarter \n</span>
<span class="sd">        calendar_quarter_lag \n</span>
<span class="sd">        calendar_quarter_lead \n</span>
<span class="sd">        calendar_month \n</span>
<span class="sd">        calendar_month_lag \n</span>
<span class="sd">        calendar_month_lead</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        A DataFrame with a date column and any passed kwargs.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    footings.model_tools.create_frame_from_record</span>
<span class="sd">    footings.model_tools.expand_frame_per_record</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import create_frame</span>
<span class="sd">    &gt;&gt;&gt; frame = create_frame(</span>
<span class="sd">    &gt;&gt;&gt;     start_dt = pd.Timestamp(&quot;2020-01-10&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     end_dt = pd.Timestamp(&quot;2020-05-30&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     frequency = &quot;M&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     col_date_nm = &quot;DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     duration_month = &quot;DURATION_MONTH&quot;</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame</span>
<span class="sd">    &gt;&gt;&gt; #       DATE	        DURATION_MONTH</span>
<span class="sd">    &gt;&gt;&gt; # 0	2020-01-10	1</span>
<span class="sd">    &gt;&gt;&gt; # 1	2020-02-10	2</span>
<span class="sd">    &gt;&gt;&gt; # 2	2020-03-10	3</span>
<span class="sd">    &gt;&gt;&gt; # 3	2020-04-10	4</span>
<span class="sd">    &gt;&gt;&gt; # 4	2020-05-10	5</span>
<span class="sd">    &gt;&gt;&gt; # 5	2020-06-10	6</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">end_duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;end_duration&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">tbl</span> <span class="o">=</span> <span class="n">freq_dispatcher</span><span class="p">(</span>
        <span class="n">start_dt</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
        <span class="n">end_dt</span><span class="o">=</span><span class="n">end_dt</span><span class="p">,</span>
        <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span>
        <span class="n">end_duration</span><span class="o">=</span><span class="n">end_duration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">kwarg_dispatcher</span><span class="p">(</span>
            <span class="n">tbl</span><span class="o">=</span><span class="n">tbl</span><span class="p">,</span> <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span> <span class="n">col_nm</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">start_dt</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span> <span class="n">kw</span><span class="o">=</span><span class="n">k</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">tbl</span></div>


<div class="viewcode-block" id="create_frame_from_record"><a class="viewcode-back" href="../../../generated/footings.model_tools.create_frame_from_record.html#footings.model_tools.create_frame_from_record">[docs]</a><span class="k">def</span> <span class="nf">create_frame_from_record</span><span class="p">(</span>
    <span class="n">record</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">col_start_dt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_end_dt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a frame with a date colum ranging from the start_dt to the end_dt from a record.</span>

<span class="sd">    This function is to be used when you have a record of data from a DataFrame and you want to</span>
<span class="sd">    expand the data out over a date range. Note the DataFrame must contain a column for a start date</span>
<span class="sd">    and an end date. All columns from the original record will be duplicated the length of the date</span>
<span class="sd">    range. See example for usage.</span>

<span class="sd">    If wanting to do this for many records use the function ``footings.model_tools.expand_frame_per_record``.</span>
<span class="sd">    When doing one record ``create_frame_from_record`` is faster than expand_frame_per_record.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    record : pd.DataFrame</span>
<span class="sd">        A single record from a DataFrame.</span>
<span class="sd">    col_start_dt : str</span>
<span class="sd">        The name of the start date column.</span>
<span class="sd">    col_end_dt : str</span>
<span class="sd">        The name of the end date column.</span>
<span class="sd">    frequency : str</span>
<span class="sd">        The frequency at which records are created.</span>
<span class="sd">    col_date_nm : str</span>
<span class="sd">        The column name to assign the date column.</span>
<span class="sd">    kwargs :</span>
<span class="sd">        See kwargs under footings.model_tools.create_frame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        A DataFrame with a date column, any passed kwargs, and columns from the record.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the length of record is not 1.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    footings.model_tools.create_frame</span>
<span class="sd">    footings.model_tools.expand_frame_per_record</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import create_frame_from_record</span>
<span class="sd">    &gt;&gt;&gt; record = pd.DataFrame(</span>
<span class="sd">    &gt;&gt;&gt;     {</span>
<span class="sd">    &gt;&gt;&gt;         &quot;POLICY&quot;: [&quot;P1&quot;],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;GENDER&quot;: [&quot;M&quot;],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;START_DATE&quot;: [pd.Timestamp(&quot;2020-01-10&quot;)],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;END_DATE&quot;: [pd.Timestamp(&quot;2020-05-30&quot;)]</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame = create_frame_from_record(</span>
<span class="sd">    &gt;&gt;&gt;     record=record,</span>
<span class="sd">    &gt;&gt;&gt;     col_start_dt=&quot;START_DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     col_end_dt=&quot;END_DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     frequency=&quot;M&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     col_date_nm=&quot;DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     duration_month=&quot;DURATION_MONTH&quot;</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame</span>
<span class="sd">    &gt;&gt;&gt; #       DATE            DURATION_MONTH	    POLICY      GENDER</span>
<span class="sd">    &gt;&gt;&gt; # 0     2020-01-10	1	            P1	        M</span>
<span class="sd">    &gt;&gt;&gt; # 1     2020-02-10	2	            P1	        M</span>
<span class="sd">    &gt;&gt;&gt; # 2     2020-03-10	3	            P1	        M</span>
<span class="sd">    &gt;&gt;&gt; # 3     2020-04-10	4	            P1	        M</span>
<span class="sd">    &gt;&gt;&gt; # 4     2020-05-10	5	            P1	        M</span>
<span class="sd">    &gt;&gt;&gt; # 5     2020-06-10	6	            P1	        M</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The record must be a pd.DataFrame with one row. The record pass has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start_dt</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="n">col_start_dt</span><span class="p">]</span>
    <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">col_start_dt</span><span class="p">)</span>
    <span class="n">end_dt</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="n">col_end_dt</span><span class="p">]</span>
    <span class="n">record</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">col_end_dt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">create_frame</span><span class="p">(</span>
        <span class="n">start_dt</span><span class="o">=</span><span class="n">start_dt</span><span class="p">,</span>
        <span class="n">end_dt</span><span class="o">=</span><span class="n">end_dt</span><span class="p">,</span>
        <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span>
        <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">record</span><span class="p">)</span></div>


<div class="viewcode-block" id="expand_frame_per_record"><a class="viewcode-back" href="../../../generated/footings.model_tools.expand_frame_per_record.html#footings.model_tools.expand_frame_per_record">[docs]</a><span class="k">def</span> <span class="nf">expand_frame_per_record</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">col_start_dt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_end_dt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">col_date_nm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a frame with a date colum ranging from the start_dt to the end_dt from a record.</span>

<span class="sd">    This function expands the function ``footings.model_tools.create_frame_from_record`` to cover the</span>
<span class="sd">    application of covering many records. Internally, it applies the function</span>
<span class="sd">    ``create_frame_from_record`` for each record.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : pd.DataFrame</span>
<span class="sd">        The DataFrame to expand.</span>
<span class="sd">    col_start_dt : str</span>
<span class="sd">        The name of the start date column.</span>
<span class="sd">    col_end_dt : str</span>
<span class="sd">        The name of the end date column.</span>
<span class="sd">    frequency : str</span>
<span class="sd">        The frequency at which records are created.</span>
<span class="sd">    col_date_nm : str</span>
<span class="sd">        The column name to assign the date column.</span>
<span class="sd">    kwargs :</span>
<span class="sd">        See kwargs under footings.model_tools.create_frame</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        A DataFrame with a date column, any passed kwargs, and columns from the original frame.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    footings.model_tools.create_frame</span>
<span class="sd">    footings.model_tools.create_frame_from_record</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import expand_frame_per_record</span>
<span class="sd">    &gt;&gt;&gt; df = pd.DataFrame(</span>
<span class="sd">    &gt;&gt;&gt;     {</span>
<span class="sd">    &gt;&gt;&gt;         &quot;POLICY&quot;: [&quot;P1&quot;, &quot;P2&quot;],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;GENDER&quot;: [&quot;M&quot;, &quot;F&quot;],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;START_DATE&quot;: [pd.Timestamp(&quot;2020-01-10&quot;), pd.Timestamp(&quot;2020-02-01&quot;)],</span>
<span class="sd">    &gt;&gt;&gt;         &quot;END_DATE&quot;: [pd.Timestamp(&quot;2020-05-30&quot;), pd.Timestamp(&quot;2020-04-18&quot;)]</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame = expand_frame_per_record(</span>
<span class="sd">    &gt;&gt;&gt;     frame=df,</span>
<span class="sd">    &gt;&gt;&gt;     col_start_dt=&quot;START_DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     col_end_dt=&quot;END_DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     frequency=&quot;M&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     col_date_nm=&quot;DATE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     duration_month=&quot;DURATION_MONTH&quot;</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame</span>
<span class="sd">    &gt;&gt;&gt; #       DATE            DURATION_MONTH  POLICY	    GENDER</span>
<span class="sd">    &gt;&gt;&gt; # 0     2020-01-10	1	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 1     2020-02-10	2	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 2     2020-03-10	3	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 3     2020-04-10	4	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 4     2020-05-10	5	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 5     2020-06-10	6	        P1	    M</span>
<span class="sd">    &gt;&gt;&gt; # 6     2020-02-01	1	        P2	    F</span>
<span class="sd">    &gt;&gt;&gt; # 7     2020-03-01	2	        P2	    F</span>
<span class="sd">    &gt;&gt;&gt; # 8     2020-04-01	3	        P2	    F</span>
<span class="sd">    &gt;&gt;&gt; # 9     2020-05-01	4	        P2	    F</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">create_frame_from_record</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">row</span><span class="p">,</span>
                <span class="n">col_start_dt</span><span class="o">=</span><span class="n">col_start_dt</span><span class="p">,</span>
                <span class="n">col_end_dt</span><span class="o">=</span><span class="n">col_end_dt</span><span class="p">,</span>
                <span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">,</span>
                <span class="n">col_date_nm</span><span class="o">=</span><span class="n">col_date_nm</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="frame_add_exposure"><a class="viewcode-back" href="../../../generated/footings.model_tools.frame_add_exposure.html#footings.model_tools.frame_add_exposure">[docs]</a><span class="k">def</span> <span class="nf">frame_add_exposure</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">begin_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exposure_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;EXPOSURE&quot;</span><span class="p">,</span>
    <span class="n">begin_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_BD&quot;</span><span class="p">,</span>
    <span class="n">end_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_ED&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add an exposure values to a duration based frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : pd.DataFrame</span>
<span class="sd">        The frame to add an exposure value.</span>
<span class="sd">    begin_date : pd.Timestamp, optional</span>
<span class="sd">        Begin date for measuring exposure, by default None.</span>
<span class="sd">    end_date : pd.Timestamp, optional</span>
<span class="sd">        End date for measuring exposure, by default None.</span>
<span class="sd">    exposure_name : str, optional</span>
<span class="sd">        The name to give the column added representing the exposure, by default = EXPOSURE.</span>
<span class="sd">    begin_duration_col : str, optional</span>
<span class="sd">        The column name representing the start of a duration, by default DATE_BD.</span>
<span class="sd">    end_duration_col : str, optional</span>
<span class="sd">        The column name representing the end of a duration, by default DATE_ED.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If begin_duration_col is not in frame.</span>
<span class="sd">    ValueError</span>
<span class="sd">        if end_ducration_col is not in frame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The frame with an additional column (name given to exposure) with the exposure value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    As an example, with a date of 2020-03-15 and a duration covering the period</span>
<span class="sd">    from 2020-03-10 through 2020-04-10, the exposure would be 0.838710 = 26 / 31.</span>
<span class="sd">    Notice the 15th is included as a day in the numerator and the end date is</span>
<span class="sd">    excluded in the denominator.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import frame_add_exposure</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; frame = pd.DataFrame(</span>
<span class="sd">    &gt;&gt;&gt;     {</span>
<span class="sd">    &gt;&gt;&gt;         &quot;BEGIN_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-02-10&quot;, &quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;,]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;         &quot;END_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;, &quot;2020-06-10&quot;]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; example = frame_add_exposure(</span>
<span class="sd">    &gt;&gt;&gt;     frame.copy(),</span>
<span class="sd">    &gt;&gt;&gt;     exposure_name=&quot;EXPOSURE&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     begin_duration_col=&quot;BEGIN_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     end_duration_col=&quot;END_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     begin_date=pd.Timestamp(&quot;2020-03-15&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     end_date=pd.Timestamp(&quot;2020-04-20&quot;),</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; example</span>
<span class="sd">    &gt;&gt;&gt; #       BEGIN_DURATION_COL      END_DURATION_COL	EXPOSURE</span>
<span class="sd">    &gt;&gt;&gt; # 0	2020-02-10	        2020-03-10	        0.000000</span>
<span class="sd">    &gt;&gt;&gt; # 1	2020-03-10	        2020-04-10	        0.838710</span>
<span class="sd">    &gt;&gt;&gt; # 2	2020-04-10	        2020-05-10	        0.838710</span>
<span class="sd">    &gt;&gt;&gt; # 3	2020-05-10	        2020-06-10	        0.000000</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">begin_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The begin_duration_col [</span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The end_duration_col [</span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>

    <span class="n">days_period</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">end_duration_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">frame</span><span class="p">[</span><span class="n">begin_duration_col</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
    <span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">begin_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">begin_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">end_duration_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">begin_date</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">condlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">begin_days</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">choicelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">condlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">begin_days</span> <span class="o">&lt;=</span> <span class="n">days_period</span><span class="p">)</span>
        <span class="n">choicelist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">begin_days</span><span class="p">)</span> <span class="o">/</span> <span class="n">days_period</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">end_duration_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">end_date</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">condlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end_days</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">choicelist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">end_days</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">days_period</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">frame</span><span class="p">[</span><span class="n">exposure_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span></div>


<div class="viewcode-block" id="frame_add_weights"><a class="viewcode-back" href="../../../generated/footings.model_tools.frame_add_weights.html#footings.model_tools.frame_add_weights">[docs]</a><span class="k">def</span> <span class="nf">frame_add_weights</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">as_of_dt</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">begin_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_BD&quot;</span><span class="p">,</span>
    <span class="n">end_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_ED&quot;</span><span class="p">,</span>
    <span class="n">wt_current_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;WT_0&quot;</span><span class="p">,</span>
    <span class="n">wt_next_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;WT_1&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add cell weights to a duration based frame as an as of date.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : pd.DataFrame</span>
<span class="sd">        The frame to add an exposure value.</span>
<span class="sd">    as_of_dt : pd.Timestamp</span>
<span class="sd">        The as of date to assign weights.</span>
<span class="sd">    begin_duration_col : str, optional</span>
<span class="sd">        The column name representing the start of a duration, by default DATE_BD.</span>
<span class="sd">    end_duration_col : str, optional</span>
<span class="sd">        The column name representing the end of a duration, by default DATE_ED.</span>
<span class="sd">    wt_currrent_name : str, optional</span>
<span class="sd">        The name of the column representing the current duration, by default WT_0.</span>
<span class="sd">    wt_next_name : str, optional</span>
<span class="sd">        The name of the column representing the next duration, by default WT_1.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If begin_duration_col is not in frame.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If end_duration_col is not in frame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The frame with an additional column (name given to exposure) with the exposure value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    As an example, with a date of 2020-02-15 and a duration covering the period</span>
<span class="sd">    from 2020-02-10 through 2020-03-10, the current period weight would be</span>
<span class="sd">    0.827586 = 24 / 29. Notice the 15th is included as a day in the numerator</span>
<span class="sd">    and tend end date is excluded as a day in the numerator. The next period</span>
<span class="sd">    weight would be 1 - 0.827586 or 0.172414.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import frame_add_weights</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; frame = pd.DataFrame(</span>
<span class="sd">    &gt;&gt;&gt;     {</span>
<span class="sd">    &gt;&gt;&gt;         &quot;BEGIN_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-02-10&quot;, &quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;,]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;         &quot;END_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;, &quot;2020-06-10&quot;]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; example = frame_add_weights(</span>
<span class="sd">    &gt;&gt;&gt;     frame.copy(),</span>
<span class="sd">    &gt;&gt;&gt;     begin_duration_col=&quot;BEGIN_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     end_duration_col=&quot;END_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     as_of_dt=pd.Timestamp(&quot;2020-02-15&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     wt_current_name=&quot;WT_0&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     wt_next_name=&quot;WT_1&quot;,</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; example</span>
<span class="sd">    &gt;&gt;&gt; #     	    BEGIN_DURATION_COL  END_DURATION_COL        WT_0        WT_1</span>
<span class="sd">    &gt;&gt;&gt; # 0	    2020-02-10	        2020-03-10	        0.827586    0.172414</span>
<span class="sd">    &gt;&gt;&gt; # 1	    2020-03-10	        2020-04-10	        0.827586    0.172414</span>
<span class="sd">    &gt;&gt;&gt; # 2	    2020-04-10	        2020-05-10	        0.827586    0.172414</span>
<span class="sd">    &gt;&gt;&gt; # 3	    2020-05-10	        2020-06-10	        0.827586    0.172414</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">begin_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The begin_duration_col [</span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The end_duration_col [</span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2"> &lt;= @as_of_dt and </span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2"> &gt;= @as_of_dt&quot;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[[</span><span class="n">begin_duration_col</span><span class="p">,</span> <span class="n">end_duration_col</span><span class="p">]]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">dur_n_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">end_duration_col</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">src</span><span class="p">[</span><span class="n">begin_duration_col</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
    <span class="n">wt_current</span> <span class="o">=</span> <span class="p">((</span><span class="n">src</span><span class="p">[</span><span class="n">end_duration_col</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">as_of_dt</span><span class="p">)</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">/</span> <span class="n">dur_n_days</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">wt_current_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">wt_current</span>
    <span class="n">frame</span><span class="p">[</span><span class="n">wt_next_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">wt_current</span>
    <span class="k">return</span> <span class="n">frame</span></div>


<div class="viewcode-block" id="frame_filter"><a class="viewcode-back" href="../../../generated/footings.model_tools.frame_filter.html#footings.model_tools.frame_filter">[docs]</a><span class="k">def</span> <span class="nf">frame_filter</span><span class="p">(</span>
    <span class="n">frame</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">begin_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">begin_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_BD&quot;</span><span class="p">,</span>
    <span class="n">end_duration_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DATE_ED&quot;</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Filter a duration based frame based on a being and/or an end date.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : pd.DataFrame</span>
<span class="sd">        The frame to add an exposure value.</span>
<span class="sd">    begin_date : pd.Timestamp, optional</span>
<span class="sd">        Begin date for measuring exposure, by default None.</span>
<span class="sd">    end_date : pd.Timestamp, optional</span>
<span class="sd">        End date for measuring exposure, by default None.</span>
<span class="sd">    begin_duration_col : str, optional</span>
<span class="sd">        The column name representing the start of a duration, by default DATE_BD.</span>
<span class="sd">    end_duration_col : str, optional</span>
<span class="sd">        The column name representing the end of a duration, by default DATE_ED.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If begin_duration_col is not in frame.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If end_duration_col is not in frame.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The frame with an additional column (name given to exposure) with the exposure value.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from footings.model_tools import frame_filter</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; frame = pd.DataFrame(</span>
<span class="sd">    &gt;&gt;&gt;     {</span>
<span class="sd">    &gt;&gt;&gt;         &quot;BEGIN_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-02-10&quot;, &quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;,]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;         &quot;END_DURATION_COL&quot;: pd.to_datetime(</span>
<span class="sd">    &gt;&gt;&gt;             [&quot;2020-03-10&quot;, &quot;2020-04-10&quot;, &quot;2020-05-10&quot;, &quot;2020-06-10&quot;]</span>
<span class="sd">    &gt;&gt;&gt;         ),</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; frame</span>
<span class="sd">    &gt;&gt;&gt; #   BEGIN_DURATION_COL  END_DURATION_COL</span>
<span class="sd">    &gt;&gt;&gt; # 0 2020-02-10          2020-03-10</span>
<span class="sd">    &gt;&gt;&gt; # 1 2020-03-10          2020-04-10</span>
<span class="sd">    &gt;&gt;&gt; # 2 2020-04-10          2020-05-10</span>
<span class="sd">    &gt;&gt;&gt; # 3 2020-05-10          2020-06-10</span>
<span class="sd">    &gt;&gt;&gt;</span>
<span class="sd">    &gt;&gt;&gt; example = frame_filter(</span>
<span class="sd">    &gt;&gt;&gt;     frame,</span>
<span class="sd">    &gt;&gt;&gt;     begin_date=pd.Timestamp(&quot;2020-03-15&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     end_date=pd.Timestamp(&quot;2020-05-01&quot;),</span>
<span class="sd">    &gt;&gt;&gt;     begin_duration_col=&quot;BEGIN_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt;     end_duration_col=&quot;END_DURATION_COL&quot;,</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; example</span>
<span class="sd">    &gt;&gt;&gt; #   BEGIN_DURATION_COL  END_DURATION_COL</span>
<span class="sd">    &gt;&gt;&gt; # 1 2020-03-10          2020-04-10</span>
<span class="sd">    &gt;&gt;&gt; # 2 2020-04-10          2020-05-10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">begin_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The begin_duration_col [</span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">end_duration_col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The end_duration_col [</span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2">] is not in the frame.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">begin_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2"> &gt;= @begin_date&quot;</span>
    <span class="k">elif</span> <span class="n">begin_date</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2"> &lt;= @end_date&quot;</span>
    <span class="k">elif</span> <span class="n">begin_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_duration_col</span><span class="si">}</span><span class="s2"> &gt;= @begin_date and </span><span class="si">{</span><span class="n">begin_duration_col</span><span class="si">}</span><span class="s2"> &lt;= @end_date&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">frame</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span></div>
</pre></div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../../_static/js/index.d3f166471bb80abb5163.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, Dustin Tindall.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>